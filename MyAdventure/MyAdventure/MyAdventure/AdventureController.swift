import Foundationimport Combineclass AdventureController: ObservableObject {    @Published private(set) var currentNode: AdventureNode    @Published private(set) var path: [String] = []    @Published var isEnded: Bool = false    @Published var lastEndingWasSuccess: Bool = false    @Published var endingMessage: String = ""    private var nodes: [String: AdventureNode] = [:]    init() {        self.currentNode = AdventureNode(id: "placeholder", title: "", description: "", options: [])        buildAdventure()        // now nodes["start"] should exist        if let start = nodes["start"] {            currentNode = start        } else {            // fallback - should not happen if buildAdventure constructs "start"            currentNode = AdventureNode(id: "start_missing", title: "Missing Start", description: "Adventure not built", options: [])        }    }    private func buildAdventure() {        let treasureEnding = AdventureNode(            id: "treasure_end",            title: "Escape",            description: "You found a hidden raft and escaped!",            options: []        )        let lostEnding = AdventureNode(            id: "lost_end",            title: "Lost",            description: "You wandered too far and couldnâ€™t find your way back.",            options: []        )        nodes["treasure_end"] = treasureEnding        nodes["lost_end"] = lostEnding        let caveNode = AdventureNode(            id: "cave",            title: "Dark Cave",            description: "You hear strange noises...",            options: [                AdventureOption(title: "Explore deeper", nextNodeID: "treasure_end", success: true),                AdventureOption(title: "Turn back", nextNodeID: "start", success: nil)            ]        )        let cliffNode = AdventureNode(            id: "cliff",            title: "Windy Cliff",            description: "A high drop with a gorgeous view.",            options: [                AdventureOption(title: "Climb down", nextNodeID: "lost_end", success: false),                AdventureOption(title: "Head back", nextNodeID: "start", success: nil)            ]        )        let startNode = AdventureNode(            id: "start",            title: "Crescent Isle",            description: "You wake up stranded. Three paths appear before you.",            options: [                AdventureOption(title: "Enter the cave", nextNodeID: "cave", success: nil),                AdventureOption(title: "Climb the cliff", nextNodeID: "cliff", success: nil),                AdventureOption(title: "Walk along the beach", nextNodeID: "lost_end", success: false)            ]        )        nodes["start"] = startNode        nodes["cave"] = caveNode        nodes["cliff"] = cliffNode    }    func choose(option: AdventureOption) {        path.append(currentNode.id)        if let nextID = option.nextNodeID, let next = nodes[nextID] {            if next.options.isEmpty {                isEnded = true                lastEndingWasSuccess = option.success ?? false                endingMessage = next.description            }            currentNode = next        } else {            isEnded = true            lastEndingWasSuccess = option.success ?? false            endingMessage = option.title        }    }    func reset() {        path = []        isEnded = false        lastEndingWasSuccess = false        endingMessage = ""        if let start = nodes["start"] {            currentNode = start        }    }}